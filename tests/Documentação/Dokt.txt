ğŸ“Š DOCUMENTAÃ‡ÃƒO DE TESTES UNITÃRIOS â€“ CRUD DE USUÃRIOS
ğŸš€ VISÃƒO GERAL

Este documento descreve os testes unitÃ¡rios implementados para o mÃ³dulo de gerenciamento de usuÃ¡rios (user_routes.py).
O objetivo Ã© garantir que as rotas crÃ­ticas do sistema QuimiDocs atendam corretamente Ã s regras de negÃ³cio, validaÃ§Ãµes de seguranÃ§a e tratamento de erros.

EstratÃ©gia aplicada:

pytest + mongomock â†’ garante isolamento sem afetar banco real.

JWT â†’ testes de rotas protegidas exigem autenticaÃ§Ã£o de administrador.

Cobertura completa CRUD â†’ registro, login, listagem, atualizaÃ§Ã£o e deleÃ§Ã£o de usuÃ¡rios.

ğŸ” 1. FIXTURE E AMBIENTE

client(monkeypatch) cria instÃ¢ncia da aplicaÃ§Ã£o em modo teste (create_app(testing=True)).

Substitui User.collection() por banco em memÃ³ria (mongomock).

get_auth_header registra e autentica admin, retornando Authorization: Bearer <token> para acessar rotas restritas.

ğŸ§ª 2. TESTES DE REGISTRO (/register)
âœ… test_register_success

Entrada vÃ¡lida (nome_do_usuario, email, senha, nivel).

Esperado: 201 Created + mensagem "UsuÃ¡rio registrado com sucesso".

Confirma retorno de id e dados consistentes.

âœ… test_register_duplicate_email

Registra usuÃ¡rio com email X.

Tenta registrar novamente com mesmo email.

Esperado: 409 Conflict + "Email jÃ¡ estÃ¡ em uso".

âœ… test_register_weak_password

Usa senha fraca ("123").

Esperado: 400 Bad Request + "Senha deve ter pelo menos 8 caracteres...".

ğŸ“Œ Cobertura de seguranÃ§a: validaÃ§Ãµes robustas (email vÃ¡lido, senha forte, duplicidade).

ğŸ” 3. TESTES DE LOGIN (/login)
âœ… test_login_success

UsuÃ¡rio registrado com credenciais vÃ¡lidas.

Esperado: 200 OK + access_token + dados do usuÃ¡rio.

âœ… test_login_invalid

Tenta logar com email inexistente.

Esperado: 401 Unauthorized + "Email ou senha invÃ¡lidos".

ğŸ“Œ Cobertura de seguranÃ§a: protege contra login sem credenciais vÃ¡lidas.

ğŸ“‹ 4. TESTES DE LISTAGEM (/users)
âœ… test_list_users

Admin cadastrado + outro usuÃ¡rio.

RequisiÃ§Ã£o GET /users autenticada.

Esperado: 200 OK + lista contendo ambos os emails.

ğŸ“Œ Cobertura de seguranÃ§a: rota protegida por role_required([ADMIN]).

âœï¸ 5. TESTES DE ATUALIZAÃ‡ÃƒO (PUT /users/<id>)
âœ… test_update_user_success

Cria usuÃ¡rio, atualiza nome_do_usuario.

Esperado: 200 OK + "UsuÃ¡rio atualizado com sucesso".

âœ… test_update_user_conflict_email

Cria dois usuÃ¡rios distintos.

Tenta atualizar email do segundo para o email do primeiro.

Esperado: 409 Conflict + "Email jÃ¡ estÃ¡ em uso por outro usuÃ¡rio".

ğŸ“Œ Cobertura de seguranÃ§a: validaÃ§Ã£o de ObjectId e duplicidade de email.

ğŸ—‘ï¸ 6. TESTES DE DELEÃ‡ÃƒO (DELETE /users/<id>)
âœ… test_delete_user_success

Cria usuÃ¡rio.

Deleta via rota autenticada.

Esperado: 200 OK + "UsuÃ¡rio deletado com sucesso".

ğŸ“Œ Cobertura de seguranÃ§a: validaÃ§Ã£o de ID + restriÃ§Ã£o de acesso a admins.